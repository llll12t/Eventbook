<!-- index.html -->
<!DOCTYPE html> 
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>รีวิวกิจกรรม</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
  <style>
    .star-rating { direction: rtl; display: inline-block; }
    .star-rating input[type="radio"] { display: none; }
    .star-rating label { color: #ccc; font-size: 2rem; cursor: pointer; }
    .star-rating input[type="radio"]:checked ~ label,
    .star-rating label:hover,
    .star-rating label:hover ~ label { color: #f5b301; }

    .glass {
      background: rgba(255, 255, 255, 0.5);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(3.5px);
      -webkit-backdrop-filter: blur(3.5px);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
  </style>
</head>
<body class="bg-gradient-to-b from-blue-100 via-orange-100 to-white min-h-screen relative bg-fixed p-2">
  <div class="max-w-md mx-auto glass p-6  rounded-lg shadow">
    <h1 class="text-xl font-bold text-[#0A164D] mb-4">แบบประเมินกิจกรรม</h1>
    <form id="feedbackForm">
      <input type="hidden" id="roomId" name="roomId" />
      <input type="hidden" id="userIdLine" name="userIdLine" />
      <div class="mb-3">
        <label class="block text-gray-700">ชื่อกิจกรรม</label>
        <input type="text" id="roomName" name="roomName" class="w-full p-2 text-white bg-[#071d4a] rounded-lg" readonly />
      </div>
      <div class="mb-3">
        <label class="block text-gray-700">ชื่อผู้เข้าร่วม</label>
        <input type="text" id="bookerName" name="bookerName" class="w-full p-2 text-white bg-[#071d4a] rounded-lg" readonly />
      </div>
      <div class="flex gap-4 mb-6">
        <div class="flex-1">
          <label class="block text-gray-700">วันที่</label>
          <input type="text" id="date" name="date" class="w-full p-2 text-white bg-[#071d4a] rounded-lg" readonly />
        </div>
        <div class="flex-1">
          <label class="block text-gray-700">เวลา</label>
          <input type="text" id="time" name="time" class="w-full p-2 text-white bg-[#071d4a] rounded-lg" readonly />
        </div>
      </div>

      <!-- 1 -->
      <div class="mb-6">
        <p class="text-gray-700 mb-2">1. ความน่าสนใจของหัวข้อและเนื้อหาของกิจกรรม</p>
        <div class="star-rating">
          <input type="radio" id="q1-5" name="q1" value="5" /><label for="q1-5"><i class="fas fa-star"></i></label>
          <input type="radio" id="q1-4" name="q1" value="4" /><label for="q1-4"><i class="fas fa-star"></i></label>
          <input type="radio" id="q1-3" name="q1" value="3" /><label for="q1-3"><i class="fas fa-star"></i></label>
          <input type="radio" id="q1-2" name="q1" value="2" /><label for="q1-2"><i class="fas fa-star"></i></label>
          <input type="radio" id="q1-1" name="q1" value="1" required /><label for="q1-1"><i class="fas fa-star"></i></label>
        </div>
      </div>

      <!-- 2 -->
      <div class="mb-6">
        <p class="text-gray-700 mb-2">2. รูปแบบการดำเนินกิจกรรมมีความเหมาะสม</p>
        <div class="star-rating">
          <input type="radio" id="q2-5" name="q2" value="5" /><label for="q2-5"><i class="fas fa-star"></i></label>
          <input type="radio" id="q2-4" name="q2" value="4" /><label for="q2-4"><i class="fas fa-star"></i></label>
          <input type="radio" id="q2-3" name="q2" value="3" /><label for="q2-3"><i class="fas fa-star"></i></label>
          <input type="radio" id="q2-2" name="q2" value="2" /><label for="q2-2"><i class="fas fa-star"></i></label>
          <input type="radio" id="q2-1" name="q2" value="1" required /><label for="q2-1"><i class="fas fa-star"></i></label>
        </div>
      </div>

      <!-- 3 -->
      <div class="mb-6">
        <p class="text-gray-700 mb-2">3. การประชาสัมพันธ์ และการสมัครเข้าร่วมของกิจกรรมมีความเหมาะสม</p>
        <div class="star-rating">
          <input type="radio" id="q3-5" name="q3" value="5" /><label for="q3-5"><i class="fas fa-star"></i></label>
          <input type="radio" id="q3-4" name="q3" value="4" /><label for="q3-4"><i class="fas fa-star"></i></label>
          <input type="radio" id="q3-3" name="q3" value="3" /><label for="q3-3"><i class="fas fa-star"></i></label>
          <input type="radio" id="q3-2" name="q3" value="2" /><label for="q3-2"><i class="fas fa-star"></i></label>
          <input type="radio" id="q3-1" name="q3" value="1" required /><label for="q3-1"><i class="fas fa-star"></i></label>
        </div>
      </div>

      <!-- 4 -->
      <div class="mb-6">
        <p class="text-gray-700 mb-2">4. วิทยากร หรือผู้ดำเนินกิจกรรมมีความเหมาะสม</p>
        <div class="star-rating">
          <input type="radio" id="q4-5" name="q4" value="5" /><label for="q4-5"><i class="fas fa-star"></i></label>
          <input type="radio" id="q4-4" name="q4" value="4" /><label for="q4-4"><i class="fas fa-star"></i></label>
          <input type="radio" id="q4-3" name="q4" value="3" /><label for="q4-3"><i class="fas fa-star"></i></label>
          <input type="radio" id="q4-2" name="q4" value="2" /><label for="q4-2"><i class="fas fa-star"></i></label>
          <input type="radio" id="q4-1" name="q4" value="1" required /><label for="q4-1"><i class="fas fa-star"></i></label>
        </div>
      </div>

      <!-- 5 -->
      <div class="mb-6">
        <p class="text-gray-700 mb-2">5. ความคุ้มค่าของกิจกรรม สามารถนำประสบการณ์ที่ได้รับไปต่อยอดได้</p>
        <div class="star-rating">
          <input type="radio" id="q5-5" name="q5" value="5" /><label for="q5-5"><i class="fas fa-star"></i></label>
          <input type="radio" id="q5-4" name="q5" value="4" /><label for="q5-4"><i class="fas fa-star"></i></label>
          <input type="radio" id="q5-3" name="q5" value="3" /><label for="q5-3"><i class="fas fa-star"></i></label>
          <input type="radio" id="q5-2" name="q5" value="2" /><label for="q5-2"><i class="fas fa-star"></i></label>
          <input type="radio" id="q5-1" name="q5" value="1" required /><label for="q5-1"><i class="fas fa-star"></i></label>
        </div>
      </div>

      <!-- 6 -->
      <div class="mb-6">
        <p class="text-gray-700 mb-2">6. ความเหมาะสมของสถานที่และอุปกรณ์อำนวยความสะดวก</p>
        <div class="star-rating">
          <input type="radio" id="q6-5" name="q6" value="5" /><label for="q6-5"><i class="fas fa-star"></i></label>
          <input type="radio" id="q6-4" name="q6" value="4" /><label for="q6-4"><i class="fas fa-star"></i></label>
          <input type="radio" id="q6-3" name="q6" value="3" /><label for="q6-3"><i class="fas fa-star"></i></label>
          <input type="radio" id="q6-2" name="q6" value="2" /><label for="q6-2"><i class="fas fa-star"></i></label>
          <input type="radio" id="q6-1" name="q6" value="1" required /><label for="q6-1"><i class="fas fa-star"></i></label>
        </div>
      </div>

      <!-- 7 -->
      <div class="mb-6">
        <p class="text-gray-700 mb-2">7. ความเหมาะสมของวัน เวลาที่จัดกิจกรรม</p>
        <div class="star-rating">
          <input type="radio" id="q7-5" name="q7" value="5" /><label for="q7-5"><i class="fas fa-star"></i></label>
          <input type="radio" id="q7-4" name="q7" value="4" /><label for="q7-4"><i class="fas fa-star"></i></label>
          <input type="radio" id="q7-3" name="q7" value="3" /><label for="q7-3"><i class="fas fa-star"></i></label>
          <input type="radio" id="q7-2" name="q7" value="2" /><label for="q7-2"><i class="fas fa-star"></i></label>
          <input type="radio" id="q7-1" name="q7" value="1" required /><label for="q7-1"><i class="fas fa-star"></i></label>
        </div>
      </div>

      <!-- 8 -->
      <div class="mb-6">
        <p class="text-gray-700 mb-2">8. สรุปภาพรวมความพึงพอใจที่ท่านได้รับจากการจัดกิจกรรมในครั้งนี้</p>
        <div class="star-rating">
          <input type="radio" id="q8-5" name="q8" value="5" /><label for="q8-5"><i class="fas fa-star"></i></label>
          <input type="radio" id="q8-4" name="q8" value="4" /><label for="q8-4"><i class="fas fa-star"></i></label>
          <input type="radio" id="q8-3" name="q8" value="3" /><label for="q8-3"><i class="fas fa-star"></i></label>
          <input type="radio" id="q8-2" name="q8" value="2" /><label for="q8-2"><i class="fas fa-star"></i></label>
          <input type="radio" id="q8-1" name="q8" value="1" required /><label for="q8-1"><i class="fas fa-star"></i></label>
        </div>
      </div>

      <!-- 9 -->
      <div class="mb-6">
        <label class="block text-gray-700 mb-1">9. ความเห็นเพิ่มเติม</label>
        <textarea id="q9" name="q9" rows="3" class="w-full p-2 border rounded-lg"></textarea>
      </div>

      <button type="submit" class="w-full p-3 bg-[#0A164D] text-white font-bold rounded-lg hover:bg-[#0C1958]">
        ส่งความคิดเห็น
      </button>
    </form>
  </div>

  <script>
    // ดึง state จาก LIFF แล้วเติมค่าในช่อง readonly
    const p = new URLSearchParams(
      decodeURIComponent(new URLSearchParams(window.location.search).get("liff.state")||"").replace(/^\?/, "")
    );
    document.getElementById("roomId").value    = p.get("eventId")    || "";
    document.getElementById("roomName").value  = p.get("activity")   || "";
    document.getElementById("bookerName").value= p.get("bookerName") || "";
    document.getElementById("date").value      = p.get("date")       || "";
    document.getElementById("time").value      = p.get("time")       || "";
    document.getElementById("userIdLine").value= p.get("useridline") || "";

    document.getElementById("feedbackForm").addEventListener("submit", e => {
      e.preventDefault();
      const data = {
        method: "submitFeedback",
        roomId:    p.get("eventId"),
        roomName:  p.get("activity"),
        bookerName:p.get("bookerName"),
        date:      p.get("date"),
        time:      p.get("time"),
        userIdLine:p.get("useridline"),
        q1: document.querySelector('input[name="q1"]:checked')?.value,
        q2: document.querySelector('input[name="q2"]:checked')?.value,
        q3: document.querySelector('input[name="q3"]:checked')?.value,
        q4: document.querySelector('input[name="q4"]:checked')?.value,
        q5: document.querySelector('input[name="q5"]:checked')?.value,
        q6: document.querySelector('input[name="q6"]:checked')?.value,
        q7: document.querySelector('input[name="q7"]:checked')?.value,
        q8: document.querySelector('input[name="q8"]:checked')?.value,
        q9: document.getElementById("q9").value
      };
      // ตรวจสอบครบ 1–8
      for(let i=1;i<=8;i++){
        if(!data["q"+i]){
          return Swal.fire("กรุณาให้คะแนนทุกข้อ","","error");
        }
      }
      Swal.fire({ title:"กำลังส่งข้อมูล...", didOpen:()=>Swal.showLoading(), allowOutsideClick:false });
      fetch("https://script.google.com/macros/s/AKfycbxtbN_-k9O_yxP1QTsXsQajYwLh4yL8oEG_eA5iKofRcCTuKTO8KL0ghJMDiDbMQ34nxQ/exec",{
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body:new URLSearchParams(data)
      })
      .then(r=>r.json())
      .then(res=>{
        if(res.success){
          Swal.fire("ส่งเรียบร้อย","ขอบคุณสำหรับความคิดเห็น!","success").then(()=>window.close());
        } else {
          Swal.fire("ผิดพลาด",res.message||"ไม่สามารถบันทึกข้อมูลได้","error");
        }
      })
      .catch(()=>Swal.fire("ผิดพลาด","ไม่สามารถเชื่อมต่อเซิร์ฟเวอร์","error"));
    });
  </script>
</body>
</html>
