<!DOCTYPE html> 
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>รีวิวกิจกรรม</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
  <style>
    .star-rating { direction: rtl; display: inline-block; }
    .star-rating input[type="radio"] { display: none; }
    .star-rating label { color: #ccc; font-size: 1.5rem; cursor: pointer; }
    .star-rating input[type="radio"]:checked ~ label,
    .star-rating label:hover,
    .star-rating label:hover ~ label { color: #f5b301; }
  </style>
</head>
<body class="text-sm bg-gray-50">
  <div class="max-w-md mx-auto bg-white p-6 mt-6 rounded shadow">
    <h1 class="text-xl font-bold text-[#0A164D] mb-4">แบบประเมินกิจกรรม</h1>
    <form id="feedbackForm">
      <!-- ข้อมูลกิจกรรม (readonly) -->
      <input type="hidden" id="roomId" name="roomId" />
      <input type="hidden" id="userIdLine" name="userIdLine" />
      <div class="mb-4"><label>ชื่อกิจกรรม</label>
        <input type="text" id="roomName" name="roomName" class="w-full p-2 bg-gray-100 rounded" readonly />
      </div>
      <div class="mb-4"><label>ชื่อผู้เข้าร่วม</label>
        <input type="text" id="bookerName" name="bookerName" class="w-full p-2 bg-gray-100 rounded" readonly />
      </div>
      <div class="flex gap-4 mb-6">
        <div class="flex-1">
          <label>วันที่</label>
          <input type="text" id="date" name="date" class="w-full p-2 bg-gray-100 rounded" readonly />
        </div>
        <div class="flex-1">
          <label>เวลา</label>
          <input type="text" id="time" name="time" class="w-full p-2 bg-gray-100 rounded" readonly />
        </div>
      </div>

      <!-- 1. ความน่าสนใจของหัวข้อและเนื้อหา -->
      <div class="mb-6">
        <p class="mb-2">1. ความน่าสนใจของหัวข้อและเนื้อหาของกิจกรรม</p>
        <div class="star-rating">
          ${[5,4,3,2,1].map(v=>`
            <input type="radio" id="q1-${v}" name="q1" value="${v}" required />
            <label for="q1-${v}"><i class="fas fa-star"></i></label>
          `).join('')}
        </div>
      </div>

      <!-- 2. รูปแบบการดำเนินกิจกรรม -->
      <div class="mb-6">
        <p class="mb-2">2. รูปแบบการดำเนินกิจกรรมของมีความเหมาะสม</p>
        <div class="star-rating">
          ${[5,4,3,2,1].map(v=>`
            <input type="radio" id="q2-${v}" name="q2" value="${v}" required />
            <label for="q2-${v}"><i class="fas fa-star"></i></label>
          `).join('')}
        </div>
      </div>

      <!-- 3. ประชาสัมพันธ์และการสมัครเข้าร่วม -->
      <div class="mb-6">
        <p class="mb-2">3. การประชาสัมพันธ์ และการสมัครเข้าร่วมของกิจกรรมมีความเหมาะสม</p>
        <div class="star-rating">
          ${[5,4,3,2,1].map(v=>`
            <input type="radio" id="q3-${v}" name="q3" value="${v}" required />
            <label for="q3-${v}"><i class="fas fa-star"></i></label>
          `).join('')}
        </div>
      </div>

      <!-- 4. วิทยากรหรือผู้ดำเนินกิจกรรม -->
      <div class="mb-6">
        <p class="mb-2">4. วิทยากร หรือผู้ดำเนินกิจกรรมมีความเหมาะสม</p>
        <div class="star-rating">
          ${[5,4,3,2,1].map(v=>`
            <input type="radio" id="q4-${v}" name="q4" value="${v}" required />
            <label for="q4-${v}"><i class="fas fa-star"></i></label>
          `).join('')}
        </div>
      </div>

      <!-- 5. ความคุ้มค่าของกิจกรรม -->
      <div class="mb-6">
        <p class="mb-2">5. ความคุ้มค่าของกิจกรรม สามารถนำเอาประสบการณ์ที่ได้รับไปต่อยอดได้</p>
        <div class="star-rating">
          ${[5,4,3,2,1].map(v=>`
            <input type="radio" id="q5-${v}" name="q5" value="${v}" required />
            <label for="q5-${v}"><i class="fas fa-star"></i></label>
          `).join('')}
        </div>
      </div>

      <!-- 6. สถานที่และอุปกรณ์อำนวยความสะดวก -->
      <div class="mb-6">
        <p class="mb-2">6. ความเหมาะสมของสถานที่และอุปกรณ์อำนวยความสะดวก</p>
        <div class="star-rating">
          ${[5,4,3,2,1].map(v=>`
            <input type="radio" id="q6-${v}" name="q6" value="${v}" required />
            <label for="q6-${v}"><i class="fas fa-star"></i></label>
          `).join('')}
        </div>
      </div>

      <!-- 7. วัน/เวลาที่จัดกิจกรรม -->
      <div class="mb-6">
        <p class="mb-2">7. ความเหมาะสมของ วัน เวลาที่จัดกิจกรรม</p>
        <div class="star-rating">
          ${[5,4,3,2,1].map(v=>`
            <input type="radio" id="q7-${v}" name="q7" value="${v}" required />
            <label for="q7-${v}"><i class="fas fa-star"></i></label>
          `).join('')}
        </div>
      </div>

      <!-- 8. ภาพรวมความพึงพอใจ -->
      <div class="mb-6">
        <p class="mb-2">8. สรุปภาพรวมความพึงพอใจที่ท่านได้รับจากการจัดกิจกรรมในครั้งนี้</p>
        <div class="star-rating">
          ${[5,4,3,2,1].map(v=>`
            <input type="radio" id="q8-${v}" name="q8" value="${v}" required />
            <label for="q8-${v}"><i class="fas fa-star"></i></label>
          `).join('')}
        </div>
      </div>

      <!-- 9. ความเห็นเพิ่มเติม -->
      <div class="mb-6">
        <label class="block mb-1">9. ความเห็นเพิ่มเติม</label>
        <textarea id="q9" name="q9" rows="3" class="w-full p-2 border rounded"></textarea>
      </div>

      <button type="submit" class="w-full p-3 bg-[#0A164D] text-white font-bold rounded hover:bg-[#0C1958]">
        ส่งความคิดเห็น
      </button>
    </form>
  </div>

  <script>
    // ดึงค่า state จาก LIFF
    const params = new URLSearchParams(
      decodeURIComponent(new URLSearchParams(window.location.search).get("liff.state") || "").replace(/^\?/, "")
    );
    ["eventId","activity","bookerName","date","time","useridline"].forEach(k=>{
      if (params.get(k)) document.getElementById(k==="activity"?"roomName":k).value = params.get(k);
    });

    document.getElementById("feedbackForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const data = {
        method: "submitFeedback",
        roomId: params.get("eventId"),
        roomName: params.get("activity"),
        bookerName: params.get("bookerName"),
        date: params.get("date"),
        time: params.get("time"),
        userIdLine: params.get("useridline"),
        q1: document.querySelector('input[name="q1"]:checked')?.value,
        q2: document.querySelector('input[name="q2"]:checked')?.value,
        q3: document.querySelector('input[name="q3"]:checked')?.value,
        q4: document.querySelector('input[name="q4"]:checked')?.value,
        q5: document.querySelector('input[name="q5"]:checked')?.value,
        q6: document.querySelector('input[name="q6"]:checked')?.value,
        q7: document.querySelector('input[name="q7"]:checked')?.value,
        q8: document.querySelector('input[name="q8"]:checked')?.value,
        q9: document.getElementById("q9").value
      };
      // ตรวจสอบครบทุกข้อ (ยกเว้น q9)
      for (let i=1; i<=8; i++){
        if (!data["q"+i]) {
          return Swal.fire("กรุณาให้คะแนนทุกข้อ", "", "error");
        }
      }
      Swal.fire({ title: "กำลังส่งข้อมูล...", didOpen: ()=> Swal.showLoading(), allowOutsideClick:false });
      fetch("https://script.google.com/macros/s/AKfycbxtbN_-k9O_yxP1QTsXsQajYwLh4yL8oEG_eA5iKofRcCTuKTO8KL0ghJMDiDbMQ34nxQ/exec", {
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body: new URLSearchParams(data)
      })
      .then(res=>res.json())
      .then(res=>{
        if (res.success) {
          Swal.fire("ส่งเรียบร้อย","ขอบคุณสำหรับความคิดเห็น!","success").then(()=> window.close());
        } else {
          Swal.fire("ผิดพลาด", res.message||"ไม่สามารถบันทึกข้อมูลได้","error");
        }
      })
      .catch(()=> Swal.fire("ผิดพลาด","ไม่สามารถเชื่อมต่อเซิร์ฟเวอร์","error"));
    });
  </script>
</body>
</html>
