<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
 <script>
  window.onload = function () {
  // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ liff.state ‡∏à‡∏≤‡∏Å query string ‡∏à‡∏£‡∏¥‡∏á
  const query = new URLSearchParams(window.location.search);
  let actualQuery = query.get("liff.state") || window.location.search;

  // ‡πÅ‡∏Å‡πâ‡∏Å‡∏£‡∏ì‡∏µ liff.state ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ã‡πâ‡∏≥‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô
  try {
    while (actualQuery.includes("%")) {
      const decoded = decodeURIComponent(actualQuery);
      if (decoded === actualQuery) break;
      actualQuery = decoded;
    }
  } catch (err) {
    console.warn("Decode error:", err);
  }

  // ‡πÅ‡∏õ‡∏•‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô query string
  const urlParams = new URLSearchParams(actualQuery.replace(/^\?/, ''));
  const id = urlParams.get('id');
  const activity = urlParams.get('activity');
  const bookerName = urlParams.get('bookerName');
  const date = urlParams.get('date');
  const time = urlParams.get('time');

  // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  document.getElementById('activity').textContent = activity || '-';
  document.getElementById('bookerName').textContent = bookerName || '-';
  document.getElementById('datetime').textContent = `${date || '-'} ‡πÄ‡∏ß‡∏•‡∏≤ ${time || '-'}`;

  // ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
  document.getElementById("yesBtn").onclick = () => submitConfirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß", id);
  document.getElementById("noBtn").onclick = () => submitConfirm("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å", id);
};

async function submitConfirm(status, id) {
  const apiUrl = `https://script.google.com/macros/s/AKfycbwOiSYN37QTLiFdz8F0VfVBHGGsoA7Rn6DoAQn0ZBa7Ss6E-UP6WDZVncDgnVby1cVOyQ/exec?method=updateConfirmData&id=${id}&confirmStatus=${status}`;
  try {
    const res = await fetch(apiUrl);
    const text = await res.text();
    alert(text);
    if (window.liff && liff.closeWindow) liff.closeWindow();
  } catch (err) {
    alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
    console.error(err);
  }
}

</script>

  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 60px; }
    .info { margin: 10px 0; font-size: 18px; }
    button {
      margin: 10px;
      padding: 10px 25px;
      font-size: 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #yesBtn { background-color: #4CAF50; color: white; }
    #noBtn { background-color: #f44336; color: white; }
  </style>
</head>
<body>
  <h2>üìå ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
  <div class="info">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: <span id="activity"></span></div>
  <div class="info">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: <span id="bookerName"></span></div>
  <div class="info">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: <span id="datetime"></span></div>

  <button id="yesBtn">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
  <button id="noBtn">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</body>
</html>
