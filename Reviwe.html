<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4 text-center">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>

    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå -->
    <div class="mb-6 text-gray-700 space-y-1">
      <p>‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á: <span id="displayId" class="font-medium"></span></p>
      <p>‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: <span id="displayEventId" class="font-medium"></span></p>
      <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: <span id="displayBookerName" class="font-medium"></span></p>
      <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="displayDate" class="font-medium"></span> ‡πÄ‡∏ß‡∏•‡∏≤: <span id="displayTime" class="font-medium"></span></p>
    </div>

    <form id="reviewForm" class="space-y-4">
      <!-- ‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å URL -->
      <input type="hidden" id="id" name="id" />
      <input type="hidden" id="eventId" name="eventId" />
      <input type="hidden" id="bookerName" name="bookerName" />
      <input type="hidden" id="date" name="date" />
      <input type="hidden" id="time" name="time" />
      <input type="hidden" id="useridline" name="useridline" />

      <!-- 5 ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° rating -->
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏° (1‚Äì5)</label>
        <select id="service" name="service" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£0 (1‚Äì5)</label>
        <select id="service0" name="service0" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£1 (1‚Äì5)</label>
        <select id="service1" name="service1" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£2 (1‚Äì5)</label>
        <select id="service2" name="service2" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£3 (1‚Äì5)</label>
        <select id="service3" name="service3" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>

      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded">‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
    </form>
    <p id="status" class="mt-4 text-center"></p>
  </div>

  <script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbwOiSYN37QTLiFdz8F0VfVBHGGsoA7Rn6DoAQn0ZBa7Ss6E-UP6WDZVncDgnVby1cVOyQ/exec';

    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name) || '';
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function init() {
      // keys ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å URL
      const keys = ['id','eventId','bookerName','date','time','useridline'];
      keys.forEach(k => {
        const v = getParam(k);
        // ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ hidden field
        document.getElementById(k).value = v;
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô display ‡∏´‡∏≤‡∏Å‡∏°‡∏µ
        const disp = document.getElementById('display' + capitalize(k));
        if (disp) disp.innerText = v;
      });
    }

    document.getElementById('reviewForm').addEventListener('submit', async e => {
      e.preventDefault();
      const f = e.target;
      // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      const s0 = Number(f.service.value), s1 = Number(f.service0.value),
            s2 = Number(f.service1.value), s3 = Number(f.service2.value),
            s4 = Number(f.service3.value);
      const data = {
        method: 'insertReviewData',
        id: f.id.value,
        eventId: f.eventId.value,
        bookerName: f.bookerName.value,
        date: f.date.value,
        time: f.time.value,
        service: s0,
        service0: s1,
        service1: s2,
        service2: s3,
        service3: s4,
        totalScore: s0 + s1 + s2 + s3 + s4,
        useridline: f.useridline.value
      };
      const resp = await fetch(scriptUrl, {
        method: 'POST',
        body: JSON.stringify(data)
      });
      document.getElementById('status').innerText =
        resp.ok ? '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡∏ß‡∏¥‡∏ß üôè' : '‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
    });

    init();
  </script>
</body>
</html>
