<!-- Review.html -->
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4 text-center">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
    <form id="reviewForm" class="space-y-4">
      <input type="hidden" id="id" name="id" />
      <input type="hidden" id="eventId" name="eventId" />
      <input type="hidden" id="bookerName" name="bookerName" />
      <input type="hidden" id="date" name="date" />
      <input type="hidden" id="time" name="time" />
      <input type="hidden" id="useridline" name="useridline" />

      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏° (1‚Äì5)</label>
        <select id="service" name="service" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£0 (1‚Äì5)</label>
        <select id="service0" name="service0" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£1 (1‚Äì5)</label>
        <select id="service1" name="service1" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£2 (1‚Äì5)</label>
        <select id="service2" name="service2" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>
      <div>
        <label class="block mb-1">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£3 (1‚Äì5)</label>
        <select id="service3" name="service3" class="w-full border p-2 rounded">
          <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
        </select>
      </div>

      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded">‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
    </form>
    <p id="status" class="mt-4 text-center"></p>
  </div>

  <script>
    const scriptUrl = 'https://script.google.com/macros/s/<<YOUR_DEPLOY_ID>>/exec';
    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name) || '';
    }
    async function init() {
      await liff.init({ liffId: '<<YOUR_LIFF_ID>>' });
      const profile = await liff.getProfile();
      document.getElementById('useridline').value = profile.userId;
      ['id','eventId','bookerName','date','time'].forEach(k => {
        document.getElementById(k).value = getParam(k);
      });
    }
    document.getElementById('reviewForm').addEventListener('submit', async e => {
      e.preventDefault();
      const f = e.target;
      const data = {
        method: 'insertReviewData',
        id: f.id.value,
        eventId: f.eventId.value,
        bookerName: f.bookerName.value,
        date: f.date.value,
        time: f.time.value,
        service: f.service.value,
        service0: f.service0.value,
        service1: f.service1.value,
        service2: f.service2.value,
        service3: f.service3.value,
        totalScore: ['service','service0','service1','service2','service3']
          .reduce((sum, key) => sum + Number(f[key].value), 0),
        useridline: f.useridline.value
      };
      const resp = await fetch(scriptUrl, {
        method: 'POST',
        body: JSON.stringify(data)
      });
      document.getElementById('status').innerText =
        resp.ok ? '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡∏ß‡∏¥‡∏ß üôè' : '‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
    });
    init();
  </script>
</body>
</html>
