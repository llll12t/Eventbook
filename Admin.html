<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Admin จัดการจองกิจกรรม</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- config.js สำหรับ API_URL -->
  <script src="config.js"></script>

</head>
<body class="bg-gradient-to-b from-blue-100 via-orange-100 to-white min-h-screen relative bg-fixed p-4">
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <span class="text-white text-xl">Loading...</span>
  </div>
  <div class="mb-4 flex justify-between sm:flex-row gap-4">
    <div>
      <label class="block text-sm mb-1">สถานะ</label>
      <select id="filter-status" class="border px-3 py-2 rounded-xl bg-white w-40" style="-webkit-appearance:none; -moz-appearance:none; appearance:none;">
        <option value="">ทั้งหมด</option>
        <option value="รอดำเนินการ">รอดำเนินการ</option>
        <option value="เตรียมร่วมกิจกรรม">เตรียมร่วมกิจกรรม</option>
        <option value="เสร็จสิ้น">เสร็จสิ้น</option>
        <option value="ยกเลิก">ยกเลิก</option>
      </select>
    </div>
    <div>
      <label class="block text-sm mb-1">วันที่</label>
        <input type="date" id="filter-date" class="border px-3 py-2 bg-white rounded-xl w-40 "style="-webkit-appearance:none; -moz-appearance:none; appearance:none;">
    </div>
    <!-- <div class="flex items-end">
      <button onclick="renderGroups()" class="bg-blue-600 text-white px-4 py-2 rounded">ค้นหา</button>
    </div> -->
  </div>
  
  <!-- Container สำหรับกลุ่มกิจกรรม -->
  <div id="groups-container" class="space-y-6"></div>
   <!-- Modals สำหรับอัพเดทรายการเดี่ยว -->
  <!-- 1. ชำระเงิน -->
  <div id="update-payment-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-4 rounded-xl w-11/12 max-w-md">
      <h2 class="text-lg font-bold mb-4">อัพเดทการชำระเงิน</h2>
      <form id="update-payment-form">
        <input type="hidden" id="payment-update-id">
        <div class="mb-2">
          <label class="block text-sm">การชำระเงิน</label>
          <select id="update-payment-select" class="w-full border px-2 py-1 rounded">
            <option value="ชำระเงินแล้ว">ชำระเงินแล้ว</option>
            <option value="รอการชำระเงิน">รอการชำระเงิน</option>
            <option value="ยกเลิก">ยกเลิก</option>
          </select>
        </div>
        <div class="flex justify-end">
          <button type="button" onclick="closePaymentModal()" class="bg-gray-500 text-white py-1 px-3 rounded mr-2">ยกเลิก</button>
          <button type="submit" class="bg-blue-500 text-white py-1 px-3 rounded">บันทึก</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 2. แจ้งเข้าร่วม -->
  <div id="update-join-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-4 rounded-xl w-11/12 max-w-md">
      <h2 class="text-lg font-bold mb-4">อัพเดทแจ้งเข้าร่วม</h2>
      <form id="update-join-form">
        <input type="hidden" id="join-update-id">
        <div class="mb-2">
          <label class="block text-sm">แจ้งเข้าร่วม</label>
          <select id="update-join-select" class="w-full border px-2 py-1 rounded">
            <option value="แจ้งแล้ว">แจ้งแล้ว</option>
            <option value="ยังไม่แจ้ง">ยังไม่แจ้ง</option>
          </select>
        </div>
        <div class="flex justify-end">
          <button type="button" onclick="closeJoinModal()" class="bg-gray-500 text-white py-1 px-3 rounded mr-2">ยกเลิก</button>
          <button type="submit" class="bg-blue-500 text-white py-1 px-3 rounded">บันทึก</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 3. สถานะยืนยัน -->
  <div id="update-confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-4 rounded-xl w-11/12 max-w-md">
      <h2 class="text-lg font-bold mb-4">อัพเดทสถานะยืนยัน</h2>
      <form id="update-confirm-form">
        <input type="hidden" id="confirm-update-id">
        <div class="mb-2">
          <label class="block text-sm">สถานะยืนยัน</label>
          <select id="update-confirm-select" class="w-full border px-2 py-1 rounded">
            <option value="ยืนยันแล้ว">ยืนยันแล้ว</option>
            <option value="ยกเลิก">ยกเลิก</option>
          </select>
        </div>
        <div class="flex justify-end">
          <button type="button" onclick="closeConfirmModal()" class="bg-gray-500 text-white py-1 px-3 rounded mr-2">ยกเลิก</button>
          <button type="submit" class="bg-blue-500 text-white py-1 px-3 rounded">บันทึก</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modals สำหรับอัพเดทกลุ่มทั้งหมด -->
  <!-- 4. แจ้งเข้าร่วม ทั้งกลุ่ม -->
  <div id="update-group-join-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-4 rounded-xl w-11/12 max-w-md">
      <h2 class="text-lg font-bold mb-4">อัพเดทแจ้งเข้าร่วม (กลุ่ม)</h2>
      <form id="update-group-join-form">
        <input type="hidden" id="group-join-update-id">
        <div class="mb-2">
          <label class="block text-sm">แจ้งเข้าร่วม</label>
          <select id="update-group-join-select" class="w-full border px-2 py-1 rounded">
            <option value="แจ้งแล้ว">แจ้งแล้ว</option>
            <option value="ยังไม่แจ้ง">ยังไม่แจ้ง</option>
          </select>
        </div>
        <div class="flex justify-end">
          <button type="button" onclick="closeGroupJoinModal()" class="bg-gray-500 text-white py-1 px-3 rounded mr-2">ยกเลิก</button>
          <button type="submit" class="bg-blue-500 text-white py-1 px-3 rounded">บันทึก</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 5. สถานะยืนยัน ทั้งกลุ่ม -->
  <div id="update-group-confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-4 rounded-xl w-11/12 max-w-md">
      <h2 class="text-lg font-bold mb-4">อัพเดทสถานะยืนยัน (กลุ่ม)</h2>
      <form id="update-group-confirm-form">
        <input type="hidden" id="group-confirm-update-id">
        <div class="mb-2">
          <label class="block text-sm">สถานะยืนยัน</label>
          <select id="update-group-confirm-select" class="w-full border px-2 py-1 rounded">
            <option value="ยืนยันแล้ว">ยืนยันแล้ว</option>
            <option value="ยกเลิก">ยกเลิก</option>
          </select>
        </div>
        <div class="flex justify-end">
          <button type="button" onclick="closeGroupConfirmModal()" class="bg-gray-500 text-white py-1 px-3 rounded mr-2">ยกเลิก</button>
          <button type="submit" class="bg-blue-500 text-white py-1 px-3 rounded">บันทึก</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let tableData = [];
    let eventCaps = {};  // เก็บ capacity ของแต่ละ eventId

    function startLoading() { $('#loading-overlay').removeClass('hidden'); }
    function stopLoading()  { $('#loading-overlay').addClass('hidden'); }

    // Fetch + แปลงข้อมูล
    async function fetchData() {
      startLoading();
      try {
        const resp = await fetch(WEB_APP_URL);
        const { appointments, events } = await resp.json();

        // สร้าง map ของ capacity: { A1:5, A2:15, ... }
        eventCaps = {};
        events.slice(1).forEach(row => {
          const [ eventId, , , cap ] = row;
          eventCaps[String(eventId)] = Number(cap) || 0;
        });

        // แปลง appointments
        tableData = appointments.slice(1).map(r => ({
          id:           String(r[0]),
          eventId:      String(r[1]),
          activityName:  r[2],
          category:      r[3],
          price:         r[4],
          date:          r[5],
          time:          r[6],
          queue:         r[7],
          bookerName:    r[8],
          bookerENG:     r[9],
          idCard:        r[10],
          address:       r[11],
          phone:         r[12],
          email:         r[13],
          note:          r[14],
          status:        r[15],
          payment:       r[16],
          joinStatus:    r[17],
          confirmStatus: r[18],
          additionalNotes:r[19],
          useridline:    r[20]
        }));

        renderGroups();
      } catch (err) {
        Swal.fire('Error','ไม่สามารถโหลดข้อมูลได้','error');
      } finally {
        stopLoading();
      }
    }

    function groupBy(arr, key) {
      return arr.reduce((acc, cur) => {
        (acc[cur[key]] = acc[cur[key]]||[]).push(cur);
        return acc;
      }, {});
    }

    // แสดงกลุ่ม พร้อมจำนวนจอง/จำนวนสูงสุด
    function renderGroups() {
        const container = $('#groups-container').empty();
        const statusFilter = $('#filter-status').val();
        const dateFilter = $('#filter-date').val();

        let filtered = tableData;

        if (statusFilter) {
            filtered = filtered.filter(x => x.status === statusFilter);
        }

        if (dateFilter) {
            const [yyyy, mm, dd] = dateFilter.split("-");
            const formatted = `${dd}-${mm}-${yyyy}`;
            filtered = filtered.filter(x => x.date === formatted);
            }


        const groups = groupBy(filtered, 'eventId');

      for (const [eventId, items] of Object.entries(groups)) {
        const h = items[0];
        const booked = items.length;
        const cap    = eventCaps[eventId] || 0;

        const box = $(`
          <div class="p-4 bg-white rounded-xl shadow">
            <div class="flex justify-between items-center mb-2">
              <div class="font-bold">
                ${eventId} ${h.activityName}<br>
                ${h.date} ${h.time}
                <span class="ml-2 text-sm text-gray-600">(${booked}/${cap})</span>
              </div>
<div class="flex justify-end flex-row space-x-2">
                <button class="bg-yellow-500 text-white py-1 px-3 rounded" onclick="openGroupJoinModal('${eventId}')">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#FFFFFF" fill="none">
                      <path d="M5.15837 11.491C5.08489 12.887 5.16936 14.373 3.92213 15.3084C3.34164 15.7438 3 16.427 3 17.1527C3 18.1508 3.7818 19 4.8 19H19.2C20.2182 19 21 18.1508 21 17.1527C21 16.427 20.6584 15.7438 20.0779 15.3084C18.8306 14.373 18.9151 12.887 18.8416 11.491C18.6501 7.85223 15.6438 5 12 5C8.35617 5 5.34988 7.85222 5.15837 11.491Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                      <path d="M10.5 3.125C10.5 3.95343 11.1716 5 12 5C12.8284 5 13.5 3.95343 13.5 3.125C13.5 2.29657 12.8284 2 12 2C11.1716 2 10.5 2.29657 10.5 3.125Z" stroke="currentColor" stroke-width="1.5" />
                      <path d="M15 19C15 20.6569 13.6569 22 12 22C10.3431 22 9 20.6569 9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </button>
                <button class="bg-green-500 text-white py-1 px-3 rounded" onclick="openGroupConfirmModal('${eventId}')">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#FFFFFF" fill="none">
                    <path d="M14.2618 3.59937C13.1956 2.53312 12.6625 2 12 2C11.3375 2 10.8044 2.53312 9.73815 3.59937C9.09832 4.2392 8.46427 4.53626 7.55208 4.53626C6.7556 4.53626 5.62243 4.38178 5 5.00944C4.38249 5.63214 4.53628 6.76065 4.53628 7.55206C4.53628 8.46428 4.2392 9.09832 3.59935 9.73817C2.53312 10.8044 2.00001 11.3375 2 12C2.00002 12.6624 2.53314 13.1956 3.59938 14.2618C4.31616 14.9786 4.53628 15.4414 4.53628 16.4479C4.53628 17.2444 4.38181 18.3776 5.00949 19C5.63218 19.6175 6.76068 19.4637 7.55206 19.4637C8.52349 19.4637 8.99128 19.6537 9.68457 20.347C10.2749 20.9374 11.0663 22 12 22C12.9337 22 13.7251 20.9374 14.3154 20.347C15.0087 19.6537 15.4765 19.4637 16.4479 19.4637C17.2393 19.4637 18.3678 19.6175 18.9905 19M20.4006 9.73817C21.4669 10.8044 22 11.3375 22 12C22 12.6624 21.4669 13.1956 20.4006 14.2618C19.6838 14.9786 19.4637 15.4414 19.4637 16.4479C19.4637 17.2444 19.6182 18.3776 18.9905 19M18.9905 19H19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M8.5 9.5L12 13L21.0002 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                </button>
              </div>            </div>
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-gray-100">
                  <th class="px-2 py-1">ชื่อ-สกุล</th>
                  <th class="px-2 py-1">ชำระเงิน</th>
                  <th class="px-2 py-1">สถานะยืนยัน</th>
                  <th class="px-2 py-1">เพิ่มเติม</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>`);

        const tbody = box.find('tbody');
        items.forEach(it => {
          tbody.append(`
            <tr data-id="${it.id}">
              <td class="border px-2 py-1">${it.bookerName}</td>
              <td class="border px-2 py-1">${it.payment}</td>
              <td class="border px-2 py-1">${it.confirmStatus}</td>
              <td class="border px-2 py-1 text-center">
                <button class="bg-[#071D4A] text-white py-1 px-2 rounded" onclick="toggleDetailsInGroup('${it.id}', this)">
                  <span class="material-icons-round text-base">expand_more</span>
                </button>
              </td>
            </tr>`);
        });

        container.append(box);
      }
    }

     // ขยายรายละเอียดของแต่ละแถว
     function toggleDetailsInGroup(itemId, btn) {
      const row = btn.closest('tr');
      if (row.nextElementSibling && row.nextElementSibling.classList.contains('details-row')) {
        row.nextElementSibling.remove();
        return;
      }
      const it = tableData.find(x => x.id === itemId);
      const html = `
        <tr class="details-row bg-gray-50">
          <td colspan="4" class="p-3 border-t">
            <div class="space-y-1 text-sm">
              <div><strong>ไอดี:</strong> ${it.id}</div>
              <div><strong>ไอดีกิจกรรม:</strong> ${it.eventId}</div>
              <div><strong>ชื่อกิจกรรม:</strong> ${it.activityName}</div>
              <div><strong>หมวดหมู่:</strong> ${it.category}</div>
              <div><strong>ราคา:</strong> ${it.price}</div>
              <div><strong>วันที่/เวลา:</strong> ${it.date} ${it.time}</div>
              <div><strong>จำนวน:</strong> ${it.queue}</div>
              <div><strong>ชื่อ-สกุล:</strong> ${it.bookerName}</div>
              <div><strong>ชื่อ-สกุลENG:</strong> ${it.bookerENG}</div>
              <div><strong>บัตรประชาชน:</strong> ${it.idCard}</div>
              <div><strong>ที่อยู่:</strong> ${it.address}</div>
              <div><strong>อีเมล:</strong> ${it.email}</div>
              <div><strong>หมายเหตุ:</strong> ${it.note}</div>
              <div><strong>สถานะ:</strong> ${it.status}</div>
              <div><strong>ชำระเงิน:</strong> ${it.payment}</div>
              <div><strong>แจ้งเข้าร่วม:</strong> ${it.joinStatus}</div>
              <div><strong>สถานะยืนยัน:</strong> ${it.confirmStatus}</div>
              <div><strong>บันทึกเพิ่มเติม:</strong> ${it.additionalNotes||'-'}</div>
            </div>
            <div class="mt-3 flex flex-wrap gap-2">
              <button class="bg-blue-500 text-white py-1 px-3 rounded" onclick="openPaymentModal('${it.id}')">ชำระเงิน</button>
              <button class="bg-green-500 text-white py-1 px-3 rounded" onclick="openJoinModal('${it.id}')">แจ้งเข้าร่วม</button>
              <button class="bg-orange-500 text-white py-1 px-3 rounded" onclick="openConfirmModal('${it.id}')">ยืนยัน</button>
              <button class="bg-yellow-500 text-white py-1 px-3 rounded" onclick="openEditModal('${it.id}')">แก้ไข</button>
              <button class="bg-red-500 text-white py-1 px-3 rounded" onclick="deleteRecord('${it.id}')">ลบ</button>
            </div>
          </td>
        </tr>`;
      row.insertAdjacentHTML('afterend', html);
    }

// ชำระเงิน
function openPaymentModal(id) {
      $('#payment-update-id').val(id);
      $('#update-payment-select').val(tableData.find(x=>x.id===id).payment);
      $('#update-payment-modal').removeClass('hidden');
    }
    function closePaymentModal() {
      $('#update-payment-modal').addClass('hidden');
    }
    $('#update-payment-form').on('submit', function(e){
      e.preventDefault(); startLoading();
      const id = $('#payment-update-id').val();
      const payment = $('#update-payment-select').val();
      $.post(WEB_APP_URL, { method:'updatePaymentData', id, payment })
        .done(() => { Swal.fire('สำเร็จ','อัพเดทชำระเงินแล้ว','success'); fetchData(); closePaymentModal(); })
        .fail(()=> Swal.fire('Error','ไม่สามารถอัพเดทได้','error'))
        .always(stopLoading);
    });

    // แจ้งเข้าร่วม
    function openJoinModal(id) {
      $('#join-update-id').val(id);
      $('#update-join-select').val(tableData.find(x=>x.id===id).joinStatus);
      $('#update-join-modal').removeClass('hidden');
    }
    function closeJoinModal() {
      $('#update-join-modal').addClass('hidden');
    }
    $('#update-join-form').on('submit', function(e){
      e.preventDefault(); startLoading();
      const id = $('#join-update-id').val();
      const joinStatus = $('#update-join-select').val();
      $.post(WEB_APP_URL, { method:'updateJoinData', id, joinStatus })
        .done(()=>{ Swal.fire('สำเร็จ','อัพเดทแจ้งเข้าร่วมแล้ว','success'); fetchData(); closeJoinModal(); })
        .fail(()=> Swal.fire('Error','ไม่สามารถอัพเดทได้','error'))
        .always(stopLoading);
    });

    // สถานะยืนยัน
    function openConfirmModal(id) {
      $('#confirm-update-id').val(id);
      $('#update-confirm-select').val(tableData.find(x=>x.id===id).confirmStatus);
      $('#update-confirm-modal').removeClass('hidden');
    }
    function closeConfirmModal() {
      $('#update-confirm-modal').addClass('hidden');
    }
    $('#update-confirm-form').on('submit', function(e){
      e.preventDefault(); startLoading();
      const id = $('#confirm-update-id').val();
      const confirmStatus = $('#update-confirm-select').val();
      $.post(WEB_APP_URL, { method:'updateConfirmData', id, confirmStatus })
        .done(()=>{ Swal.fire('สำเร็จ','อัพเดทสถานะยืนยันแล้ว','success'); fetchData(); closeConfirmModal(); })
        .fail(()=> Swal.fire('Error','ไม่สามารถอัพเดทได้','error'))
        .always(stopLoading);
    });

    // แก้ไข
    function openEditModal(id) {
      const it = tableData.find(x=>x.id===id);
      $('#edit-id').val(id);
      $('#edit-eventId').val(it.eventId);
      $('#edit-activityName').val(it.activityName);
      $('#edit-category').val(it.category);
      $('#edit-price').val(it.price);
      $('#edit-date').val(it.date);
      $('#edit-time').val(it.time);
      $('#edit-queue').val(it.queue);
      $('#edit-bookerName').val(it.bookerName);
      $('#edit-bookerENG').val(it.bookerENG);
      $('#edit-idCard').val(it.idCard);
      $('#edit-address').val(it.address);
      $('#edit-phone').val(it.phone);
      $('#edit-email').val(it.email);
      $('#edit-note').val(it.note);
      $('#edit-modal').removeClass('hidden');
    }
    function closeEditModal() {
      $('#edit-modal').addClass('hidden');
    }
    $('#edit-form').on('submit', function(e){
      e.preventDefault(); startLoading();
      const params = {
        id: $('#edit-id').val(),
        eventId: $('#edit-eventId').val(),
        activityName: $('#edit-activityName').val(),
        category: $('#edit-category').val(),
        price: $('#edit-price').val(),
        date: $('#edit-date').val(),
        time: $('#edit-time').val(),
        queue: $('#edit-queue').val(),
        bookerName: $('#edit-bookerName').val(),
        bookerENG: $('#edit-bookerENG').val(),
        idCard: $('#edit-idCard').val(),
        address: $('#edit-address').val(),
        phone: $('#edit-phone').val(),
        email: $('#edit-email').val(),
        note: $('#edit-note').val()
      };
      $.post(WEB_APP_URL, { method:'editAppointmentData', ...params })
        .done(()=>{ Swal.fire('สำเร็จ','แก้ไขข้อมูลเรียบร้อย','success'); fetchData(); closeEditModal(); })
        .fail(()=> Swal.fire('Error','ไม่สามารถแก้ไขได้','error'))
        .always(stopLoading);
    });

    // ลบ
    function deleteRecord(id) {
      Swal.fire({
        title: 'ยืนยันการลบ?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'ลบ',
        cancelButtonText: 'ยกเลิก'
      }).then(res=>{
        if(res.isConfirmed){
          startLoading();
          $.post(WEB_APP_URL, { method:'deleteAppointmentData', id })
            .done(()=>{ Swal.fire('ลบแล้ว','success'); fetchData(); })
            .fail(()=> Swal.fire('Error','ไม่สามารถลบได้','error'))
            .always(stopLoading);
        }
      });
    }

     // ** Group-level modals **
     function openGroupJoinModal(eventId) {
      $('#group-join-update-id').val(eventId);
      $('#update-group-join-select').val('แจ้งแล้ว');
      $('#update-group-join-modal').removeClass('hidden');
    }
    function closeGroupJoinModal() {
      $('#update-group-join-modal').addClass('hidden');
    }
    $('#update-group-join-form').on('submit', e => {
      e.preventDefault(); startLoading();
      const eventId = $('#group-join-update-id').val();
      const joinStatus = $('#update-group-join-select').val();
      $.post(WEB_APP_URL, { method:'updateGroupJoinData', eventId, joinStatus })
        .done(() => { Swal.fire('สำเร็จ','อัพเดทแจ้งเข้าร่วมกลุ่มเรียบร้อย','success'); fetchData(); closeGroupJoinModal(); })
        .fail(()=> Swal.fire('Error','ไม่สำเร็จ','error'))
        .always(stopLoading);
    });

    function openGroupConfirmModal(eventId) {
      $('#group-confirm-update-id').val(eventId);
      $('#update-group-confirm-select').val('ยืนยันแล้ว');
      $('#update-group-confirm-modal').removeClass('hidden');
    }
    function closeGroupConfirmModal() {
      $('#update-group-confirm-modal').addClass('hidden');
    }
    $('#update-group-confirm-form').on('submit', e => {
      e.preventDefault(); startLoading();
      const eventId = $('#group-confirm-update-id').val();
      const confirmStatus = $('#update-group-confirm-select').val();
      $.post(WEB_APP_URL, { method:'updateGroupConfirmData', eventId, confirmStatus })
        .done(() => { Swal.fire('สำเร็จ','อัพเดทสถานะยืนยันกลุ่มเรียบร้อย','success'); fetchData(); closeGroupConfirmModal(); })
        .fail(()=> Swal.fire('Error','ไม่สำเร็จ','error'))
        .always(stopLoading);
    });
    $('#filter-status, #filter-date').on('change', renderGroups);


    flatpickr("#custom-date", {
    dateFormat: "d-m-Y"
    });

    
    window.onload = fetchData;
    $(window).on('load', fetchData);
  </script>
</body>
</html>
